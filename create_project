#!/bin/bash
PROJECT_DIR="$1"
GIT_URL="$2"

if [[ "$PROJECT_DIR" = "" || "$GIT_URL" = "" ]]; then
	echo "Usage: ./create_project <DIR> <GIT_URL>"
	exit 1
fi

set -e

CONTAINER_APP_UID=9870

project_dir_parent=`dirname "$PROJECT_DIR"`
fstype=`df -T "$project_dir_parent" | tail -n 1 | awk '{ print $2 }'`
if [[ "$fstype" == vmhgfs || "$fstype" == vboxfs ]]; then
	echo "You cannot put the project dir in a VMWare or VirtualBox shared folder."
	exit 1
fi
if [[ `whoami` != root ]]; then
	echo "You must run this program as root."
	exit 1
fi

set -x

mkdir -p "$PROJECT_DIR"
echo "$GIT_URL" > "$PROJECT_DIR/git_url"
chown -R $CONTAINER_APP_UID:$CONTAINER_APP_UID "$PROJECT_DIR"
chmod 700 "$PROJECT_DIR"
